<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/public/output.css" rel="stylesheet">
    <link href="/src/JS.css" rel="stylesheet">

    <title>FrontEnd Produccion</title>
</head>

<body class="dark:bg-gray-900 h-screen img">
    <!-- <p></p> -->

    <div class=" ">
        <p class="text-center text-white text-3xl mb-5 pt-5">Pedidos</p>
        <div class=" flex justify-center mb-10">
            <button class="bg-yellow-300 rounded-sm px-1 py-1" onclick="getProductos()">Pedidos</button>
            <button class=" rounded-sm px-1 py-1" " onclick=" postProductos()"> </button>
        </div>
        <div id="productos" class="">

        </div>
    </div>

    <P class="bg-purple-700">-----------------No pasar de aqui-----------------------------</P>


    <div class="div pt-96">

        <div id="" class="m-auto bg-orange-600">
            <h1 class="bg-red-200">Hello World</h1>
            <button onclick="postProductosOnline()" class="bg-green-700"> POST</button>
            <button onclick="getProductosOnline()" class="bg-orange-500">GET</button>
            <button onclick="putProductoProcesoOnline()" class="bg-red-500">PUT</button>
            <!-- <button onclick="putProductoProcesoOnline()" class="bg-red-500">PUT</button> -->




            <table class="bg-green-300 mauto">
                <thead>
                    <tr>
                        <th>id</th>
                        <th>nombreProducto</th>
                        <th>Id Cliente</th>
                        <th>NombreCliente</th>
                        <th>Telefono</th>
                        <th>Direccion</th>
                    </tr>


                </thead>

                <tbody id="productosOnline" class="">




                </tbody>


            </table>

        </div>


    </div>



    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>

        const getProductos = async () => {
            console.log('me estas haciendo getProductos');
            //sdasd
            try {
                //!Api de practica 
                const respuesta = await axios.get('https://ventas-local-api.herokuapp.com/pedido');
                const data = respuesta.data;

                if (respuesta.status === 200) {
                    let listaProducto = '';
                    /*
                    !Lo que voy a recibir de la API
                    *Id_pedido
                    *NombreProducto
                    *Cantidad
                    */
                    //
                    data.forEach(producto => {
                        listaProducto += `
                        <div id="card">
        <div class="flex items-center justify-center py-4 px-4">
        <div class="md:w-96 rounded-md shadow-lg p-5 bg-black/50 ">
            <h1 class="pt-2 pb-7 text-gray-800 dark:text-gray-100 font-bold text-lg">Pedido</h1>
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="">
                        <!-- <img src="https://tuk-cdn.s3.amazonaws.com/can-uploader/card3-svg1.svg" alt="cart" /> -->

                    </div>
                    <a href="javascript:void(0)"
                        class="focus:outline-none focus:underline focus:text-gray-400 text-gray-600 dark:text-gray-100 ">
                        <p class=" text-sm font-medium pl-3">ID: ${producto.id_pedido} </p>
                    </a>
                </div>
                <p class="text-sm font-medium text-indigo-700"> </p>
            </div>
            <div class="flex items-center justify-between pt-5">
                <div class="flex items-center">
                    <div class="">
                        <!-- <img src="https://tuk-cdn.s3.amazonaws.com/can-uploader/card3-svg2.svg" alt="message" /> -->

                    </div>
                    <a href="javascript:void(0)"
                        class="focus:outline-none focus:underline focus:text-gray-400 text-gray-600 dark:text-gray-100 ">
                        <p class=" text-sm font-medium pl-3">Nombre Producto </p>
                        <p class=" px-2.5">${producto.nombreproducto} <span>(${producto.cantidad}) <input type="checkbox" name="" id="" class="accent-amber-600 pb-3"> </span> </p>
                        
                                
                    </a>
                </div>
            </div>
            <div class="flex items-center justify-between pt-5">
                <div class="flex items-center">
                    <div class="">
                        <!-- <img src="https://tuk-cdn.s3.amazonaws.com/can-uploader/card3-svg1.svg" alt="cart" /> -->

                    </div>
                    <a href="javascript:void(0)"
                        class="focus:outline-none focus:underline focus:text-gray-400 text-gray-600 dark:text-gray-100 hover:text-gray-400">
                        <!-- <p class=" text-sm font-medium pl-3">Cantidad <span class="bg-yellow-400 text-red-700 "></span></p> -->
                    </a>
                </div>
                <!-- <p class="text-sm font-medium text-indigo-700">$205</p> -->
            </div>
            <div class="flex items-center justify-between pt-5">
                <div class="flex items-center">
                    <div class="">
                        <!-- <img src="https://tuk-cdn.s3.amazonaws.com/can-uploader/card3-svg3.svg" alt="text" /> -->

                    </div>
                    <a href="javascript:void(0)"
                        class="focus:outline-none focus:underline focus:text-gray-400 text-gray-600 dark:text-gray-100 hover:text-gray-400">
                        <!-- <p class=" text-sm font-medium pl-3">Invoice generated</p> -->
                    </a>
                </div>
                <a href="javascript:void(0)"
                    class="focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-800 rounded-md focus:text-indigo-800 hover:text-indigo-800 text-indigo-700">
                    <!-- <p class="text-sm font-medium cursor-pointer ">View</p> -->
                </a>

            </div>
            <div class=" flex justify-center gap-4 ">
                <button class="bg-yellow-300 my-5 rounded-md w-40" onclick="putProductoProceso()">Proceso</button>
                <button class="bg-green-300 my-5 rounded-md w-40" onclick="putProductoListo()">Listo</button>
            </div>
        </div>

    </div>
    </div>
        
            `;

                        document.getElementById('productos').innerHTML = listaProducto;


                    });

                    // const putDato2 = document.getElementById('putDato');
                    // putDato2.addEventListener('click', putProducto);


                    // console.log(data[0].id_pedido);
                }

            } catch (error) {
                console.log(error);
            }



            // getProductos();



        }//!Fin getProductos


        const postProductos = async () => {
            console.log('me estas haciendo post de productos')

            const respuesta = await axios.get('https://ventas-local-api.herokuapp.com/pedido');
            const data = respuesta.data;
            await axios.post('https://api-produccion.herokuapp.com/api/pedido', {
                id_pedido: data[data.length - 1].id_pedido,
                nombreproducto: data[data.length - 1].nombreproducto,
                cantidad: data[data.length - 1].cantidad,
                estado: 'Pendiente'
            }, {
                headers: {
                    'Content-Type': 'application/json'

                }

            })
                .then(response => {
                    console.log(response);
                    // alert('Pedido agregado');
                    // getProductos();
                })
        }

        const hola = () => {
            console.log('Hola')
        }

        const putProductoProceso = async () => {
            console.log('hola me diste click putProductoProceso')
            const respuesta = await axios.get('https://ventas-local-api.herokuapp.com/pedido');
            const data = respuesta.data;

            try {
                //!Api de practica

                await axios.put(`https://api-produccion.herokuapp.com/api/actualizar/${data[data.length - 1].id_pedido}`, {
                    estado: 'Proceso'

                }), {
                    headers: {
                        'Content-Type': 'application/json',
                    }
                }


                //


            } catch (error) {
                console.log(error);
            }


        }

        const putProductoListo = async () => {
            console.log('hola me diste click putProductoListo')
            const respuesta = await axios.get('https://ventas-local-api.herokuapp.com/pedido');
            const data = respuesta.data;
            try {
                id_pedido: data[data.length - 1].id_pedido,
                    //!Api de practica 

                    await axios.put(`https://api-produccion.herokuapp.com/api/actualizar/${data[data.length - 1].id_pedido}`, {
                        estado: 'Listo'

                    }), {
                    headers: {
                        'Content-Type': 'application/json',
                    }
                }


                //


            } catch (error) {
                console.log(error);
            }


        }

        const putProductoEntregado = async () => {
            console.log('hola me diste click putProductoEntregado')
            const respuesta = await axios.get('https://ventas-local-api.herokuapp.com/pedido');
            const data = respuesta.data;
            try {
                id_pedido: data[data.length - 1].id_pedido,
                    //!Api de practica 

                    await axios.put(`https://api-produccion.herokuapp.com/api/actualizar/${data[data.length - 1].id_pedido}`, {
                        estado: 'Cancelado'

                    }), {
                    headers: {
                        'Content-Type': 'application/json',
                    }
                }


                //


            } catch (error) {
                console.log(error);
            }


        }

        const putProductoListoLimbo = async () => {
            console.log('hola me diste click putProductoListoLimbo')
            const respuesta = await axios.get('https://ventas-local-api.herokuapp.com/pedido');
            const data = respuesta.data;
            try {
                id_pedido: data[data.length - 1].id_pedido,
                    //!Api de practica 

                    await axios.put(`https://api-produccion.herokuapp.com/api/actualizar/${data[data.length - 1].id_pedido}`, {
                        estado: 'Entregado '

                    }), {
                    headers: {
                        'Content-Type': 'application/json',
                    }
                }


                //


            } catch (error) {
                console.log(error);
            }


        }

        const getProductosOnline = async () => {

            // const respuesta = await fetch('https://cafe-deer-online.herokuapp.com/api/orders')
            // const data = await respuesta.json()
            // console.log(data)
            //! const {id, name, price, quantity, total} = producto;

            // try {
            console.log('hola me hiciste get')
            const respuesta = await axios.get('https://cafe-deer-online.herokuapp.com/api/orders/produccion');
            const data = respuesta.data;
            // console.log(data)

            // console.log(data)

            console.log('Funciono')
            // console.log(data[0].orderItems[0].name
            let listaProducto = '';

            // listaProducto
            let data_table = []
            for (const item of data) {
                let baseObj = {
                    id: item._id,
                    nombreProducto: '',
                    cantidad: 0,
                    nombreCliente: item.shippingAddress.fullName,
                    idUsuario: item.user,
                    direccion: item.shippingAddress.address
                }

                item.orderItems.forEach(i => {
                    baseObj.nombreProducto = i.name
                    baseObj.cantidad = i.quantity
                    data_table.push(baseObj)

                    listaProducto += `
                    <tbody class="">
                    <tr class="text-black text-xs">
                    <th class="bg-blue-300">${baseObj.id}</th>
                    <th class="bg-red-200 max-w-xl py-1 ">**${baseObj.nombreProducto} (${baseObj.cantidad})** <button class="bg-yellow-300">Proceso </button>
                    <button class="bg-green-300">Listo </button>  </th>
                    <th class="bg-green-200" >${baseObj.idUsuario}</th>
                    <th class="bg-amber-200">${baseObj.nombreCliente}</th>
                    <th >N/A</th>
                    <th class="bg-orange-300">${baseObj.direccion}</th>
                    </tr>
                    </tbody>

        `;
                    document.getElementById('productosOnline').innerHTML = listaProducto;



                })

                // console.log(data_table)

            }


        }

        const postProductosOnline = async () => {

            console.log('me estas haciendo post de productos')


            const respuesta = await axios.get('https://cafe-deer-online.herokuapp.com/api/orders/produccion');
            const data = respuesta.data;


            await axios.post('https://api-produccion.herokuapp.com/api/online', {
                id: data[data.length - 1]._id,
                nombreProducto: data[data.length - 1].orderItems[0].name,
                cantidad: data[data.length - 1].orderItems[0].quantity,
                nombreCliente: data[data.length - 1].shippingAddress.fullName,
                idUsuario: data[data.length - 1].user,
                direccion: data[data.length - 1].shippingAddress.address,
                estado: 'Pendiente'
            }, {
                headers: {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*',
                    "Access-Control-Allow-Methods": "DELETE, POST, GET, OPTIONS",
                    "Access-Control-Allow-Headers": "Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With"


                }

            })
                .then(response => {
                    console.log(response);
                    // alert('Pedido agregado');
                    // getProductos();
                })
        }

        const putProductoProcesoOnline = async () => {

            console.log('Me diste Click desde el putProductoProcesoOnline')
            const respuesta = await axios.get('https://cafe-deer-online.herokuapp.com/api/orders/produccion');
            const data = respuesta.data;


            // data[data.length - 1]._id
            //`https://api-produccion.herokuapp.com/api/actualizaronline/${data[data.length - 1]._id}`

            await axios.put(`https://api-produccion.herokuapp.com/api/actualizaronline/1`, {

                estado: 'Listo'
            }, {
                headers: {

                    'Content-Type': 'application/json',


                    'Access-Control-Allow-Origin': '*',
                    "Access-Control-Allow-Methods": "DELETE, POST, GET, OPTIONS, PUT",
                    "Access-Control-Allow-Headers": "Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With"


                }

            })
                .then(response => {
                    console.log(response);
                    // alert('Pedido agregado');
                    // getProductos();
                })


        }




    </script>
    <!-- <script src="./limpio.js"></script> -->
    <!-- <script src="./index.js"></script> -->

</body>

</html>

<!-- !bk botones  as-->